<head>
  <title>Pokemon Type Matchups</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bangers&family=Rubik:wght@300&display=swap">
  <style>
    html {
      background-color: #121212;
      color: #bdbdbd;
      color: #a0a0a0;
      user-select: none;
      font-size: 18px;
    }
    
    a {
      color: #00bfff;
    }
    
    #main {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      
      margin: auto;
      
      font-family: Rubik, sans-serif;
      font-size: 1rem;
    }
    
    .title {
      font-weight: bold;
      font-size: 2rem;
    }
    
    
    .subtitle {
      font-weight: bold;
      font-size: 1.25rem;
    }
    
    /* Grid */
    .grid-container {
      display: grid;
      grid-template-columns: auto 18fr;
      grid-template-rows: auto 18fr;
      
      background-color: rgba(255, 255, 255, 0.20);
      border-bottom-left-radius: 0.5em;
      border-top-left-radius: 0.5em;
      border-top-right-radius: 0.5em;
      
      color: #b3b3b3;
    }
    
    #defenders {
      display: grid;
      grid-template-columns: 1fr;
      grid-template-rows: auto 1fr;
      
      font-weight: bold;
    }
    
    #attackers {
      display: grid;
      grid-template-columns: auto 1fr;
      grid-template-rows: 1fr;
      
      font-weight: bold;
    }
    
    .header {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-around;
      padding: 1rem;
    }
    
    #attackers>.header {
      writing-mode: vertical-lr;
    }
    
    #defenders>.labels {
      display: grid;
      grid-template-columns: repeat(18, 1fr);
      grid-template-rows: 1fr;
    }
    
    #attackers>.labels {
      display: grid;
      grid-template-columns: 1fr;
      grid-template-rows: repeat(18, 1fr);
    }
    
    .label {
      display: flex;
      justify-content: center;
      align-items: flex-end;
      flex-direction: column;
      
      box-sizing: border-box;
      border-top: solid 1px rgba(0, 0, 0, 0.0);
      border-left: solid 1px rgba(0, 0, 0, 0.0);
    }
      
    #defenders .label {
      padding: 1rem 0rem;
      writing-mode: vertical-lr;
    }
    
    #attackers .label {
      padding: 0rem 1rem;
    }
    
    #grid {
      display: grid;
      grid-template-columns: repeat(18, 1fr);
      grid-template-rows: repeat(18, 1fr);
      
      background-color: rgba(255, 255, 255, 0.55); 
    }
    
    .cell {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      
      aspect-ratio: 1 / 1;
      height: 2.25rem;
      
      box-sizing: border-box;
      border-top: solid 1px rgba(0, 0, 0, 0.1);
      border-left: solid 1px rgba(0, 0, 0, 0.1);
      
      font-family: 'Bangers', cursive;
      font-size: 1.5rem;
    }
    
    .cell.immune {
      color: #545454;
    }
    
    .cell.resist {
      color: #892a2a;
      font-size: 1rem;
    }
    
    .cell.normal {
      color: #767676;
    }
    
    .cell.weak {
      color: #2a892a;
    }
    
    /* Highlighting */
    
    .related {
      background-color: rgba(0, 191, 255, 0.25);
      
      box-sizing: border-box;
      border-top: solid 1px rgba(0, 0, 0, 0.0);
      border-left: solid 1px rgba(0, 0, 0, 0.0);
    }
    
    .selected {
      background-color: rgba(0, 191, 255, 0.85);
      
      box-sizing: border-box;
      border-top: solid 1px rgba(0, 0, 0, 0.0);
      border-left: solid 1px rgba(0, 0, 0, 0.0);
    }
    
    .selected.label {
      color: #2f2f2f;
    }
    
    
    
    
    
    
    
    
    .label.highlight {
      background-color: white;
    }
    #grid .cell.highlight {
      background-color: black;
    }
    .related-defender {
      background-color: red;
    }
    .related-attacker {
      background-color: blue;
    }
    .related-defender.related-attacker {
      background-color: purple;
    }
  </style>
  <script type="text/javascript">
  /*
    Order: Normal Fire Water Electric Grass Ice Fighting Poison Ground Flying Psychic Bug Rock Ghost Dragon Dark Steel Fairy
  */

  const matchups = [{
    type: 'Normal',
    immuneTo: ['Ghost'],
    resistTo: [],
    weakTo: ['Fighting']
  }, {
    type: 'Fire',
    immuneTo: [],
    resistTo: ['Fire', 'Grass', 'Ice', 'Bug', 'Steel', 'Fairy'],
    weakTo: ['Water', 'Ground', 'Rock']
  }, {
    type: 'Water',
    immuneTo: [],
    resistTo: ['Fire', 'Water', 'Ice', 'Steel'],
    weakTo: ['Electric', 'Grass']
  }, {
    type: 'Electric',
    immuneTo: [],
    resistTo: ['Electric', 'Flying', 'Steel'],
    weakTo: ['Ground']
  }, {
    type: 'Grass',
    immuneTo: [],
    resistTo: ['Water', 'Electric', 'Grass', 'Ground'],
    weakTo: ['Fire', 'Ice', 'Poison', 'Flying', 'Bug']
  }, {
    type: 'Ice',
    immuneTo: [],
    resistTo: ['Ice'],
    weakTo: ['Fire', 'Fighting', 'Rock', 'Steel']
  }, {
    type: 'Fighting',
    immuneTo: [],
    resistTo: ['Bug', 'Rock', 'Dark'],
    weakTo: ['Flying', 'Psychic', 'Fairy']
  }, {
    type: 'Poison',
    immuneTo: [],
    resistTo: ['Grass', 'Fighting', 'Poison', 'Bug', 'Fairy'],
    weakTo: ['Ground', 'Psychic']
  }, {
    type: 'Ground',
    immuneTo: ['Electric'],
    resistTo: ['Poison', 'Rock'],
    weakTo: ['Water', 'Grass', 'Ice']
  }, {
    type: 'Flying',
    immuneTo: ['Ground'],
    resistTo: ['Grass', 'Fighting', 'Bug'],
    weakTo: ['Electric', 'Ice', 'Rock']
  }, {
    type: 'Psychic',
    immuneTo: [],
    resistTo: ['Fighting', 'Psychic'],
    weakTo: ['Bug', 'Ghost', 'Dark']
  }, {
    type: 'Bug',
    immuneTo: [],
    resistTo: ['Grass', 'Fighting', 'Ground'],
    weakTo: ['Fire', 'Flying', 'Rock']
  }, {
    type: 'Rock',
    immuneTo: [],
    resistTo: ['Normal', 'Fire', 'Poison', 'Flying'],
    weakTo: ['Water', 'Grass', 'Fighting', 'Ground', 'Steel']
  }, {
    type: 'Ghost',
    immuneTo: ['Normal', 'Fighting'],
    resistTo: ['Poison', 'Bug'],
    weakTo: ['Ghost', 'Dark']
  }, {
    type: 'Dragon',
    immuneTo: [],
    resistTo: ['Fire', 'Water', 'Electric', 'Grass'],
    weakTo: ['Ice', 'Dragon', 'Fairy']
  }, {
    type: 'Dark',
    immuneTo: ['Psychic'],
    resistTo: ['Ghost', 'Dark'],
    weakTo: ['Fighting', 'Bug', 'Fairy']
  }, {
    type: 'Steel',
    immuneTo: ['Poison'],
    resistTo: ['Normal', 'Grass', 'Ice', 'Flying', 'Psychic', 'Bug', 'Rock', 'Dragon', 'Steel', 'Fairy'],
    weakTo: ['Fire', 'Fighting', 'Ground']
  }, {
    type: 'Fairy',
    immuneTo: ['Dragon'],
    resistTo: ['Fighting', 'Bug', 'Dark'],
    weakTo: ['Poison', 'Steel']
  }];

  let highlight = null;
  let lastHover = null;

  let highlights = {
    attackers: new Set(),
    defenders: new Set(),
    matchups: new Set()
  };

  function isHighlighting() {
    return highlights.attackers.size > 0 || highlights.defenders.size > 0 || highlights.matchups.size > 0;
  }

  function attackerClicked(attacker) {
    let labelEl = document.querySelector(`#attackers .label.attacker-${attacker}`);
    if (highlights.attackers.has(attacker)) {
      // Already highlighted
      
      // Record highlight removal
      highlights.attackers.delete(attacker);
      labelEl.classList.remove('highlight');
      
      // Check if any matchups coincide with this label
      let matchupObj = Array.from(highlights.matchups)
        .find((matchup) => matchup.attacker === attacker);
      
      if (!matchupObj) {
        // Remove related-attacker class from all related cells that aren't highlighted by a matchup
        let cellsEl = document.querySelectorAll(`#grid .cell.attacker-${attacker}`);
        cellsEl.forEach((el) => {
          el.classList.remove('related-attacker');
        });
      }
    } else {
      // Not highlighted yet
      
      // Record highlight
      highlights.attackers.add(attacker);
      labelEl.classList.add('highlight');
      
      // Add related-attacker class to all related cells
      let cellsEl = document.querySelectorAll(`#grid .cell.attacker-${attacker}`);
      cellsEl.forEach((el) => {
        el.classList.add('related-attacker');
      });
    }
  }

  function defenderClicked(defender) {
    let labelEl = document.querySelector(`#defenders .label.defender-${defender}`);
    if (highlights.defenders.has(defender)) {
      // Already highlighted
      
      // Record highlight removal
      highlights.defenders.delete(defender);
      labelEl.classList.remove('highlight');
      
      // Check if any matchups coincide with this label
      let matchupObj = Array.from(highlights.matchups)
        .find((matchup) => matchup.defender === defender);
      
      if (!matchupObj) {
        // Remove related-defender class from all related cells that aren't highlighted by a matchup
        let cellsEl = document.querySelectorAll(`#grid .cell.defender-${defender}`);
        cellsEl.forEach((el) => {
          el.classList.remove('related-defender');
        });
      }
    } else {
      // Not highlighted yet
      
      // Record highlight
      highlights.defenders.add(defender);
      labelEl.classList.add('highlight');
      
      // Add related-defender class to all related cells
      let cellsEl = document.querySelectorAll(`#grid .cell.defender-${defender}`);
      cellsEl.forEach((el) => {
        el.classList.add('related-defender');
      });
    }
  }

  function matchupClicked(attacker, defender) {
    let cellEl = document.querySelector(`#grid .cell.attacker-${attacker}.defender-${defender}`);
    
    // Need specific object reference for set removal
    let matchupObj = Array.from(highlights.matchups)
      .find((matchup) => matchup.attacker === attacker && matchup.defender === defender);
    
    if (matchupObj) {
      // Already highlighted
      
      // Record highlight removal
      highlights.matchups.delete(matchupObj);
      cellEl.classList.remove('highlight');
      
      // Get a conflicting attacker matchup
      let attackerMatchupObj = Array.from(highlights.matchups)
        .find((matchup) => matchup.attacker === attacker);
      
      if (!attackerMatchupObj) {
        // Remove related-attacker class from attacker label if another matchup doesn't match it
        let labelEl = document.querySelector(`#attackers .label.attacker-${attacker}`);
        labelEl.classList.remove('related-attacker');
      }
      
      if (!highlights.attackers.has(attacker) && !attackerMatchupObj) {
        // Remove related-attacker class from all related cells that aren't highlighted by a matchup
        let attackerCellsEl = document.querySelectorAll(`#grid .cell.attacker-${attacker}`);
        attackerCellsEl.forEach((el) => {
          el.classList.remove('related-attacker');
        });
      }
      
      // Get a conflicting defender matchup
      let defenderMatchupObj = Array.from(highlights.matchups)
        .find((matchup) => matchup.defender === defender);
      
      if (!defenderMatchupObj) {
        // Remove related-defender class from defender label if another matchup doesn't match it
        let labelEl = document.querySelector(`#defenders .label.defender-${defender}`);
        labelEl.classList.remove('related-defender');
      }
      
      if (!highlights.defenders.has(defender) && !defenderMatchupObj) {
        // Remove related-defender class from all related cells that aren't highlighted by a matchup
        let defenderCellsEl = document.querySelectorAll(`#grid .cell.defender-${defender}`);
        defenderCellsEl.forEach((el) => {
          el.classList.remove('related-defender');
        });
      }
    } else {
      // Not highlighted yet
      cellEl.classList.add('highlight');
      
      // Add related-attacker class to attacker label
      let attackerLabelEl = document.querySelector(`#attackers .label.attacker-${attacker}`);
      attackerLabelEl.classList.add('related-attacker');
      
      // Add related-attacker class to all attacker related cells
      let attackersEl = document.querySelectorAll(`#grid .cell.attacker-${attacker}:not(.defender-${defender}`);
      attackersEl.forEach((el) => {
        el.classList.add('related-attacker');
      });
      
      // Add related-defender class to defender label
      let defenderLabelEl = document.querySelector(`#defenders .label.defender-${defender}`);
      defenderLabelEl.classList.add('related-defender');
      
      // Add related-defender class to all defender related cells
      let defendersEl = document.querySelectorAll(`#grid .cell.defender-${defender}:not(.attacker-${attacker}`);
      defendersEl.forEach((el) => {
        el.classList.add('related-defender');
      });
      
      // Record highlight
      highlights.matchups.add({attacker: attacker, defender: defender});
    }
  }
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  function generateDefenders() {
    let elParent = document.querySelector('#defenders>.labels');

    matchups.forEach((defender) => {
      let classList = `label defender-${defender.type}`;
      
      let newCell = document.createElement('div');
      newCell.className = classList;
      newCell.innerHTML = defender.type;

      newCell.addEventListener('mouseover', (e) => {
        // lastHover = { defender: defender.type };

        // if (!isHighlighting()) {
        //   highlightRelated(null, defender.type);
        // }
      });

      newCell.addEventListener('mouseout', (e) => {
        // if (!isHighlighting()) {
        //   unhighlightRelated();
        // }
      });

      newCell.addEventListener('mousedown', (e) => defenderClicked(defender.type));

      elParent.appendChild(newCell);
    });
  }

  function generateAttackers() {
    let elParent = document.querySelector('#attackers>.labels');

    matchups.forEach((attacker) => {
      let classList = `label attacker-${attacker.type}`;
      
      let newCell = document.createElement('div');
      newCell.className = classList;
      newCell.innerHTML = attacker.type;

      newCell.addEventListener('mouseover', (e) => {
        // lastHover = { attacker: attacker.type };

        // if (!highlight) {
        //   highlightRelated(attacker.type, null);
        // }
      });

      newCell.addEventListener('mouseout', (e) => {
        // if (!highlight) {
        //   unhighlightRelated();
        // }
      });

      newCell.addEventListener('mousedown', (e) => attackerClicked(attacker.type));

      elParent.appendChild(newCell);
    });
  }

  function generateGrid() {
    let elParent = document.getElementById('grid');

    matchups.forEach((attacker) => {
      matchups.forEach((defender) => {
        let classList = `attacker-${attacker.type} defender-${defender.type}`;

        let newCell = document.createElement('div');
        newCell.className = `cell ${classList}`;

        if (defender.immuneTo.indexOf(attacker.type) > -1) {
          newCell.innerHTML = '0x';
          newCell.classList.add('immune');
        } else if (defender.resistTo.indexOf(attacker.type) > -1) {
          newCell.innerHTML = '1/2x';
          newCell.classList.add('resist');
        } else if (defender.weakTo.indexOf(attacker.type) > -1) {
          newCell.innerHTML = '2x';
          newCell.classList.add('weak');
        } else {
          newCell.classList.add('normal');
        }

        newCell.addEventListener('mouseover', (e) => {
          // lastHover = { attacker: attacker.type, defender: defender.type };

          // if (!highlight) {
          //   highlightRelated(attacker.type, defender.type);
          // }
        });

        newCell.addEventListener('mouseout', (e) => {
          // if (!highlight) {
          //   unhighlightRelated();
          // }
        });

        newCell.addEventListener('mousedown', (e) => matchupClicked(attacker.type, defender.type));

        elParent.appendChild(newCell);
      });
    });
  }
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  function generateSelectors(attacker, defender) {
    let selector;
    let sourceSelector;

    if (attacker && defender) {
      selector = `.attacker-${attacker}, .defender-${defender}`;
      sourceSelector = `.attacker-${attacker}.defender-${defender}`;
    } else if (attacker) {
      selector = `.attacker-${attacker}`;
      sourceSelector = `.label.attacker-${attacker}`;
    } else if (defender) {
      selector = `.defender-${defender}`;
      sourceSelector = `.label.defender-${defender}`;
    } else {
      return null;
    }

    return { selector, sourceSelector };
  }

  function highlightRelated(attacker, defender) {
    let { selector, sourceSelector } = generateSelectors(attacker, defender);

    let matching = document.querySelectorAll(selector);
    matching.forEach((el) => {
      el.classList.add('related');
    });

    let sourceMatch = document.querySelector(sourceSelector);
    sourceMatch.classList.remove('related');
    sourceMatch.classList.add('selected');
  }

  function unhighlightRelated() {
    let matching = document.querySelectorAll('.related, .selected');
    matching.forEach((el) => {
      el.classList.remove('related', 'selected');
    });
  }

  document.addEventListener('contextmenu', (e) => {
    e.preventDefault();
    document.querySelectorAll('.highlight').forEach((el) => el.classList.remove('highlight'));
    document.querySelectorAll('.related-attacker').forEach((el) => el.classList.remove('related-attacker'));
    document.querySelectorAll('.related-defender').forEach((el) => el.classList.remove('related-defender'));
    
    highlights = {
      attackers: new Set(),
      defenders: new Set(),
      matchups: new Set()
    };
  });
  
  </script>
</head>

<body>
  <div id="main">
    <div class="title">
      Type Matchups
    </div>
    <div class="subtitle">
      Based on Scarlet/Violet
    </div>
    <div class="grid-container">
      <div></div>
      <div id="defenders">
        <div class="header"><span>Defender</span><span>Defender</span></div>
        <div class="labels">
          <script type="text/javascript">
          generateDefenders();
          </script>
        </div>
      </div>
      <div id="attackers">
        <div class="header"><span>Attacker</span><span>Attacker</span></div>
        <div class="labels">
          <script type="text/javascript">
          generateAttackers();
          </script>
        </div>
      </div>
      <div id="grid">
        <script type="text/javascript">
        generateGrid();
        </script>
      </div>
    </div>
    <div>
      <b>Hover</b> over types/matchups to highlight -
      <b>Left click</b> to freeze highlights (You can have multiple!) -
      <b>Right click</b> to unfreeze highlights
    </div>
    <div>
      Coded by <a href="https://twitch.tv/isoitiro">Isoitiro</a>
    </div>
  </div>
</body>